---
stages:
  - build
  - deploy

Front - install deps:
  stage: build
  image: composer:latest
  only:
    changes:
      - Front/composer.json
  script:
    - cd Front
    - composer install --no-dev --no-interaction --no-scripts --optimize-autoloader
  artifacts:
    paths:
      - Front/vendor

Front - deploy:
  stage: deploy
  image: php:7.4
  only:
    changes:
      - Front/**/*
  except:
    changes:
      - Front/composer.json
  script:
    - apt-get update -yqq
    - apt-get install git zip unzip curl wget openssh-client -yqq
    - wget --quiet https://github.com/banago/PHPloy/archive/master.zip
    - unzip -qq master.zip
    - mv ./PHPloy-master/dist/phploy.phar phploy
    - php phploy -s client

Front - deploy with vendor:
  stage: deploy
  image: php:7.4
  script:
    - apt-get update -yqq
    - apt-get install git zip unzip curl wget openssh-client -yqq
    - wget --quiet https://github.com/banago/PHPloy/archive/master.zip
    - unzip -qq master.zip
    - mv ./PHPloy-master/dist/phploy.phar phploy
    - php phploy -s client-with-vendor